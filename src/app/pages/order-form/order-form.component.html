<form [formGroup]="orderForm" (ngSubmit)="onSubmit()">
  <mat-form-field appearance="fill">
    <mat-label>Payment Type</mat-label>
    <mat-select formControlName="paymentType">
      <mat-option *ngFor="let type of paymentTypes" [value]="type">{{ type }}</mat-option>
    </mat-select>
    <mat-error *ngIf="orderForm.get('paymentType')?.invalid">This field is required</mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Delivery Type</mat-label>
    <mat-select formControlName="deliveryType">
      <mat-option *ngFor="let type of deliveryTypes" [value]="type">{{ type }}</mat-option>
    </mat-select>
    <mat-error *ngIf="orderForm.get('deliveryType')?.invalid">This field is required</mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Delivery Date and Time</mat-label>
    <input matInput [matDatepicker]="picker" formControlName="deliveryDate">
    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-datepicker #picker></mat-datepicker>
    <mat-error *ngIf="orderForm.get('deliveryDate')?.invalid">This field is required</mat-error>
  </mat-form-field>

  <fieldset formGroupName="deliveryAddress">
    <legend>Delivery Address</legend>

    <mat-form-field appearance="fill">
      <mat-label>First Name</mat-label>
      <input matInput formControlName="firstName">
      <mat-error *ngIf="orderForm.get('deliveryAddress.firstName')?.invalid">This field is required</mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Last Name</mat-label>
      <input matInput formControlName="lastName">
      <mat-error *ngIf="orderForm.get('deliveryAddress.lastName')?.invalid">This field is required</mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Street</mat-label>
      <input matInput formControlName="street">
      <mat-error *ngIf="orderForm.get('deliveryAddress.street')?.invalid">This field is required</mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>House Number</mat-label>
      <input matInput formControlName="houseNumber">
      <mat-error *ngIf="orderForm.get('deliveryAddress.houseNumber')?.invalid">This field is required</mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Apartment Number</mat-label>
      <input matInput formControlName="apartmentNumber">
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Postal Code</mat-label>
      <input matInput formControlName="postalCode">
      <mat-error *ngIf="orderForm.get('deliveryAddress.postalCode')?.invalid">This field is required</mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>City</mat-label>
      <input matInput formControlName="city">
      <mat-error *ngIf="orderForm.get('deliveryAddress.city')?.invalid">This field is required</mat-error>
    </mat-form-field>
  </fieldset>

  <h3>Users Who Can Use the Lawnmower</h3>
  <ng-container formArrayName="users">
    <div *ngFor="let user of users.controls; let i = index" [formGroupName]="i">
      <fieldset>
        <legend>User {{ i + 1 }}</legend>

        <mat-form-field appearance="fill">
          <mat-label>First Name</mat-label>
          <input matInput formControlName="firstName">
          <mat-error *ngIf="user.get('firstName')?.invalid">This field is required</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Last Name</mat-label>
          <input matInput formControlName="lastName">
          <mat-error *ngIf="user.get('lastName')?.invalid">This field is required</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Street</mat-label>
          <input matInput formControlName="street">
          <mat-error *ngIf="user.get('street')?.invalid">This field is required</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>House Number</mat-label>
          <input matInput formControlName="houseNumber">
          <mat-error *ngIf="user.get('houseNumber')?.invalid">This field is required</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Apartment Number</mat-label>
          <input matInput formControlName="apartmentNumber">
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Postal Code</mat-label>
          <input matInput formControlName="postalCode">
          <mat-error *ngIf="user.get('postalCode')?.invalid">This field is required</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>City</mat-label>
          <input matInput formControlName="city">
          <mat-error *ngIf="user.get('city')?.invalid">This field is required</mat-error>
        </mat-form-field>

        <button mat-button type="button" color="warn" (click)="removeUser(i)">Remove User</button>
      </fieldset>
    </div>
  </ng-container>

  <button mat-button type="button" color="primary" (click)="addUser()">Add User</button>

  <button mat-raised-button color="primary" type="submit" [disabled]="!orderForm.valid">Place Order</button>
</form>
